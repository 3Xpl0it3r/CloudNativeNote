#### 系统性能问题

#### 人员的参与
&emsp;系统性能需要人的参与(有些规模的公司可能会有专门的性能分析部门)

#### 性能问题复杂性
##### 0x00 主观性 
&emsp;同样一个指标,每个人对其直观感受可能不一样(网站响应1s,一个人觉得可以接受,也许另外一个人就觉得无法接受)

##### 0x01 复杂性
&emsp;通常情况下一个系统并不是独立存在的,它可能有若干的子系统组成,(比如一个论坛,它有前端nginx,fpm,数据库,其中任何一个环节出现故障都会导致整个系统的故障),因此需要理清楚整个系统的依赖关系

##### 0x02 多原因,多性能问题
&emsp;有可能性能问题不只是在某一个点上(软件本身的缺陷,硬件的性能问题等等),性能问题需要量化


#### 性能的可观测性
&emsp;通过工具收集一些数据来理解整个系统,主要有以下几种方式:
- 计数器/统计数据和指标
> 内核/应用程序提供的一些状态/活动指标
> 内核主要是/proc,应用程序例如pprof,metric等
- 剖析
> 对指标采样绘图
- 跟踪
- - 静态检测
> tracepoint,内核静态钩子
- - 动态检测
> probe(kprobe,uprobe)函数里面挂的钩子
- - BPF
> BPF其实也包含tp/uprobe

#### linux性能60秒
&emsp;通用的检查方式

##### 系统整体检查
- uptime
>  最近1/5/15分钟负载
- dmesg -T|tail
> 系统事件
- top
> 整体查看

#### 内存
- vmstat -SM 1 
> 这是一个综合性的工具可以查看任务队列,上下文切换,内存情况,cpu总体情况

- free -m 
>  内存使用情况，包括文件系统缓存

##### CPU 
- mpstat -P ALL 1 
> cpu平衡情况,单个CPU繁忙意味着线程扩展不好

- pidstat 1 
> 单个进程的CPU使用情况

###### 磁盘IO
- iostat -sxz 1 
> 磁盘IO统计

###### 网络
- sar -n DEV 1 
>  网络设备IO,数据包和吞吐量

- sar -n TCP,ETCP 1 
> 检查TCP链接情况,以及重传


